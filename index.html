<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç†ç§‘ â—‹Ã— ã‚¯ã‚¤ã‚º</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; background:#f4f6f8; text-align:center; margin:0; }
.card { background:#fff; padding:24px; margin:20px auto; max-width:760px; border-radius:12px; }
button { font-size:18px; padding:10px 28px; margin:8px; }
.correct { color:green; }
.wrong { color:red; }
.review { text-align:left; margin-top:16px; }
hr { border:none; border-top:1px solid #ddd; }
</style>
</head>
<body>
<div class="card" id="game"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
let allQuestions = [];
let questions = [];
let log = [];
let current = 0;
let score = 0;
let answered = false;

Papa.parse("questions.csv", {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results) {
    allQuestions = results.data.map(row => ({
      q: row["å•é¡Œæ–‡"],
      a: row["æ­£è§£"] === "â—‹",
      e: row["è§£èª¬"] || ""
    }));
    startGame();
  },
  error: function() {
    document.getElementById("game").innerHTML = "<p>èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>";
  }
});

function startGame() {
  current = 0;
  score = 0;
  answered = false;
  log = [];
  questions = [...allQuestions].sort(() => Math.random() - 0.5).slice(0, 10);
  renderQuestion();
}

function renderQuestion() {
  answered = false;
  document.getElementById("game").innerHTML = `
    <h2>ç¬¬ ${current + 1} å• / 10</h2>
    <h3>${questions[current].q}</h3>
    <button onclick="answer(true)">â—‹</button>
    <button onclick="answer(false)">Ã—</button>
    <div id="result"></div>
    <div id="explanation"></div>
  `;
}

function answer(choice) {
  if (answered) return;
  answered = true;

  const correct = choice === questions[current].a;
  if (correct) score++;

  log.push({
    q: questions[current].q,
    correct: questions[current].a ? "â—‹" : "Ã—",
    user: choice ? "â—‹" : "Ã—",
    isCorrect: correct,
    e: questions[current].e
  });

  document.getElementById("result").textContent = correct ? "â­• æ­£è§£" : "âŒ ä¸æ­£è§£";
  document.getElementById("explanation").textContent = questions[current].e;

  document.getElementById("game").innerHTML += `
    <button onclick="next()">â¡ æ¬¡ã®å•é¡Œã¸</button>
  `;
}

function next() {
  current++;
  if (current < 10) {
    renderQuestion();
  } else {
    showReview();
  }
}

function showReview() {
  let html = `<h2>çµæœ</h2><p>å¾—ç‚¹ï¼š${score} / 10</p>`;
  html += `<div class="review">`;
  log.forEach((item, i) => {
    html += `
      <p>
        <strong>ç¬¬${i+1}å•</strong> ${item.q}<br>
        ã‚ãªãŸï¼š${item.user} ï¼ æ­£è§£ï¼š${item.correct}
        <span class="${item.isCorrect ? 'correct' : 'wrong'}">
          ${item.isCorrect ? 'ï¼ˆæ­£è§£ï¼‰' : 'ï¼ˆä¸æ­£è§£ï¼‰'}
        </span><br>
        è§£èª¬ï¼š${item.e}
      </p>
      <hr>
    `;
  });
  html += `</div>`;
  html += `<button onclick="startGame()">ğŸ” ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>`;

  document.getElementById("game").innerHTML = html;
}
</script>
</body>
</html>

